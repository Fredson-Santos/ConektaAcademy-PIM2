@startuml Diagrama de Sequência - Secretaria Cria Turma

actor Secretaria
participant "Interface Web" as Interface
participant "area_secretaria" as AreaSec
participant "Funcoes" as Funcoes
participant "Database" as DB
database "SQLite" as SQLite

== Secretaria Cria Turma ==

Secretaria -> Interface: Acessa "Gerenciamento de Turmas" > "Criar"
activate Interface

Interface -> AreaSec: area_secretaria(secretaria)
activate AreaSec

Secretaria -> Interface: Preenche nome da turma
Secretaria -> Interface: Preenche ano
Secretaria -> Interface: Seleciona curso (obrigatório)
Secretaria -> Interface: Seleciona professor (opcional)
Secretaria -> Interface: Clica "Criar Turma"

Interface -> AreaSec: criar_turma(nome, ano, curso_id, matricula_professor)
activate AreaSec

AreaSec -> Funcoes: criar_turma(nome, ano, curso_id, matricula_professor)
activate Funcoes

Funcoes -> DB: conectar()
activate DB

alt Professor foi selecionado
    Funcoes -> DB: SELECT id FROM usuarios WHERE matricula = matricula_professor AND tipo_usuario = 'professor'
    DB -> SQLite: Query
    activate SQLite
    SQLite --> DB: professor_id
    deactivate SQLite
    DB --> Funcoes: professor_id
else Professor não selecionado
    Funcoes -> Funcoes: professor_id = None
end

Funcoes -> DB: SELECT id FROM turmas WHERE nome = nome
DB -> SQLite: Query
activate SQLite
SQLite --> DB: Resultado
deactivate SQLite
DB --> Funcoes: turma_existente

alt Turma não existe
    Funcoes -> DB: INSERT INTO turmas (nome, ano, professor_id, curso_id) VALUES (?, ?, ?, ?)
    DB -> SQLite: INSERT
    activate SQLite
    SQLite --> DB: OK
    deactivate SQLite
    
    DB -> SQLite: COMMIT
    activate SQLite
    SQLite --> DB: OK
    deactivate SQLite
    
    DB --> Funcoes: Sucesso
    Funcoes --> AreaSec: True
else Turma já existe
    Funcoes --> AreaSec: False (erro: turma já existe)
end

deactivate DB
deactivate Funcoes

alt Sucesso
    AreaSec --> Interface: Turma criada com sucesso
else Erro
    AreaSec --> Interface: Erro ao criar turma
end

deactivate AreaSec

Interface --> Secretaria: Exibe mensagem (sucesso ou erro)
deactivate Interface

@enduml

